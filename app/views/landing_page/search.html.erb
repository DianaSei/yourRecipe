<div class="container recipes">
	<% @recipes.each do |r| %>

		<figure>
			<%if r.image != nil%>
	  		<%= image_tag r.image %>
	  		<%end%>
			<figcaption>
				<h5><%= link_to r.title, r.source_url %></h5>
				<%=link_to "Add to my favourites", user_recipe_create_path(user_id: current_user.id, id: r.id), method: :post%>	
				<%if r.source_url == nil%>
				<form>
		 			<spin class="vote-count-<%=r.id%>"> Likes: <%=r.votes.count%></spin> 
		 			<button class="btn btn-primary vote-btn" type = "submit" value = "<%=r.id%>"> Like</button>
	 			</form>
	 			<%end%>
			</figcaption>
		</figure>
	
	<% end %>
  
  </div>

  <script type="text/javascript">
  	$('.vote-btn').click(function(event){
	event.preventDefault();
	var recipeId = event.target.value 
	console.log(recipeId)
	$.ajax({
		method: 'POST', 
		url: `/recipe/${recipeId}/votes`,
		dataType: 'JSON',
		success: function(data){
			console.log(data)
			if(data.message == 'Successful'){
				$(`.vote-count-${recipeId}`).html(`Likes: ${data.new_count}`)
			}else if (data.message == 'Failed'){
				alert('You have already voted!')
	}
			},
			error: function(errors){
				console.log(errors)
		}
	});

});






  </script>